<div class="price-range-container">
  <!-- Hidden inputs -->
  <input
    type="hidden"
    name="{{ filter.min_value.param_name }}"
    id="{{ id_prefix }}{{ filter.label | escape }}-GTE-hidden"
    value="{% if filter.min_value.value %}{{ filter.min_value.value | money_without_currency }}{% else %}0{% endif %}"
  >
  <input
    type="hidden"
    name="{{ filter.max_value.param_name }}"
    id="{{ id_prefix }}{{ filter.label | escape }}-LTE-hidden"
    value="{% if filter.max_value.value %}{{ filter.max_value.value | money_without_currency }}{% else %}{{ filter.range_max | money_without_currency }}{% endif %}"
  >

  <!-- Slider display -->
  <div class="slider-container">
    <span class="field-currency">{{ cart.currency.symbol }}</span>
    <span class="min-value-output">
      {% if filter.min_value.value %}{{ filter.min_value.value | money_without_currency }}{% else %}0{% endif %}
    </span>

    <div class="range-slider">
      <div class="range-track">
        <div class="range-track-fill"></div>
      </div>
      <input
        type="range"
        class="min-slider"
        min="0"
        max="{{ filter.range_max | money_without_currency }}"
        value="{% if filter.min_value.value %}{{ filter.min_value.value | money_without_currency }}{% else %}0{% endif %}"
      >
      <input
        type="range"
        class="max-slider"
        min="0"
        max="{{ filter.range_max | money_without_currency }}"
        value="{% if filter.max_value.value %}{{ filter.max_value.value | money_without_currency }}{% else %}{{ filter.range_max | money_without_currency }}{% endif %}"
      >
    </div>

    <span class="field-currency">{{ cart.currency.symbol }}</span>
    <span class="max-value-output">
      {% if filter.max_value.value -%}
        {{- filter.max_value.value | money_without_currency -}}
      {%- else -%}
        {{- filter.range_max | money_without_currency -}}
      {%- endif %}
    </span>
  </div>
</div>

<style>
  .price-range-container {
    padding: 20px;
    user-select: none;
  }

  .slider-container {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .range-slider {
    position: relative;
    width: 200px;
    height: 20px;
    padding: 5px 0;
  }

  .range-track {
    position: absolute;
    height: 4px;
    background: #ddd;
    top: 50%;
    left: 0;
    right: 0;
    transform: translateY(-50%);
    z-index: 1;
  }

  .range-track-fill {
    position: absolute;
    height: 100%;
    background: #007bff;
    z-index: 2;
  }

  input[type="range"] {
    position: absolute;
    width: 100%;
    margin: 0;
    padding: 0;
    height: 20px;
    background: transparent;
    pointer-events: none;
    -webkit-appearance: none;
    z-index: 3;
  }

  input[type="range"]::-webkit-slider-thumb {
    pointer-events: all;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #007bff;
    border: 2px solid #fff;
    box-shadow: 0 0 2px rgba(0,0,0,0.3);
    cursor: pointer;
    -webkit-appearance: none;
    transition: transform 0.2s;
  }

  input[type="range"]::-moz-range-thumb {
    pointer-events: all;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: #007bff;
    border: 2px solid #fff;
    box-shadow: 0 0 2px rgba(0,0,0,0.3);
    cursor: pointer;
    transition: transform 0.2s;
  }

  input[type="range"]:hover::-webkit-slider-thumb,
  input[type="range"]:hover::-moz-range-thumb {
    transform: scale(1.2);
  }

  input[type="range"]:focus {
    outline: none;
  }

  .field-currency {
    font-weight: bold;
  }
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const containers = document.querySelectorAll('.price-range-container');
  
  containers.forEach(container => {
    const minSlider = container.querySelector('.min-slider');
    const maxSlider = container.querySelector('.max-slider');
    const minHidden = container.querySelector('#{{ id_prefix }}{{ filter.label | escape }}-GTE-hidden');
    const maxHidden = container.querySelector('#{{ id_prefix }}{{ filter.label | escape }}-LTE-hidden');
    const minOutput = container.querySelector('.min-value-output');
    const maxOutput = container.querySelector('.max-value-output');
    const trackFill = container.querySelector('.range-track-fill');
    
    function updateValues() {
      let minValue = parseFloat(minSlider.value);
      let maxValue = parseFloat(maxSlider.value);
      
      // Ensure min doesn't exceed max
      if (minValue > maxValue) {
        minSlider.value = maxValue;
        minValue = maxValue;
      }
      
      // Update hidden inputs and display
      minHidden.value = minValue;
      maxHidden.value = maxValue;
      minOutput.textContent = minValue;
      maxOutput.textContent = maxValue;
      
      // Update track fill
      const minPercent = (minValue / parseFloat(maxSlider.max)) * 100;
      const maxPercent = (maxValue / parseFloat(maxSlider.max)) * 100;
      trackFill.style.left = `${minPercent}%`;
      trackFill.style.width = `${maxPercent - minPercent}%`;
    }
    
    // Event listeners for both input and change to ensure updates
    ['input', 'change'].forEach(event => {
      minSlider.addEventListener(event, updateValues);
      maxSlider.addEventListener(event, updateValues);
    });
    
    // Hover enhancement
    const sliders = [minSlider, maxSlider];
    sliders.forEach(slider => {
      slider.addEventListener('mouseenter', () => {
        slider.style.zIndex = 4; // Bring to front when hovered
      });
      slider.addEventListener('mouseleave', () => {
        slider.style.zIndex = 3; // Return to normal z-index
      });
    });
    
    // Initial update
    updateValues();
  });
});
</script>
